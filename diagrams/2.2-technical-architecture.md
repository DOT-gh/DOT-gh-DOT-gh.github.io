# Підрозділ 2.2. Програмно-алгоритмічна реалізація адаптивної системи

## Діаграма 2.2.1: Архітектура системи (компонентна)

\`\`\`mermaid
graph TB
    subgraph "Frontend Layer"
        UI[React UI Components]
        State[Zustand State Management]
        Router[Next.js App Router]
    end
    
    subgraph "API Layer"
        API[RESTful API Endpoints]
        ServerActions[Server Actions]
        Middleware[Authentication Middleware]
    end
    
    subgraph "AI/ML Layer"
        AICore[Vercel AI SDK Core]
        AIGateway[AI Gateway]
        Models[LLM Models<br/>GPT-4, Claude, Grok]
        Adaptive[Адаптивний алгоритм]
    end
    
    subgraph "Data Layer"
        DB[(База даних<br/>PostgreSQL)]
        Cache[Redis Cache]
        Storage[File Storage]
    end
    
    subgraph "Analytics Layer"
        Monitor[Моніторинг учнів]
        Stats[Статистика]
        Reports[Звітність]
    end
    
    UI --> API
    UI --> State
    Router --> ServerActions
    
    API --> Middleware
    ServerActions --> Middleware
    Middleware --> AICore
    Middleware --> DB
    
    AICore --> AIGateway
    AIGateway --> Models
    AICore --> Adaptive
    
    Adaptive --> DB
    Monitor --> DB
    Stats --> DB
    
    DB --> Cache
    API --> Storage
\`\`\`

## Діаграма 2.2.2: Алгоритм адаптивної системи навчання

\`\`\`mermaid
flowchart TD
    Start([Початок сесії учня]) --> LoadProfile[Завантаження профілю учня]
    LoadProfile --> GetHistory[Отримання історії навчання]
    
    GetHistory --> Analyze{Аналіз даних}
    Analyze -->|Перший візит| InitLevel[Встановлення початкового рівня]
    Analyze -->|Є історія| CalcLevel[Розрахунок поточного рівня]
    
    InitLevel --> SelectContent
    CalcLevel --> SelectContent[Вибір контенту]
    
    SelectContent --> Difficulty{Визначення складності}
    Difficulty -->|Низький прогрес| Easy[Легкі завдання<br/>+підказки]
    Difficulty -->|Середній прогрес| Medium[Стандартні завдання]
    Difficulty -->|Високий прогрес| Hard[Складні завдання<br/>+бонуси]
    
    Easy --> Present[Подача матеріалу]
    Medium --> Present
    Hard --> Present
    
    Present --> Interact[Взаємодія з AI]
    Interact --> Task[Виконання завдання]
    
    Task --> Evaluate{Оцінка результату}
    Evaluate -->|0-40%| Fail[Не засвоєно]
    Evaluate -->|41-70%| Partial[Частково засвоєно]
    Evaluate -->|71-100%| Success[Засвоєно]
    
    Fail --> Explain[Детальне пояснення]
    Explain --> Retry[Повторне завдання<br/>спрощене]
    
    Partial --> Reinforce[Закріплення матеріалу]
    Reinforce --> Practice[Додаткова практика]
    
    Success --> UpdateProfile[Оновлення профілю]
    UpdateProfile --> Badge[Нарахування балів<br/>та досягнень]
    
    Retry --> SaveProgress[Збереження прогресу]
    Practice --> SaveProgress
    Badge --> SaveProgress
    
    SaveProgress --> Continue{Продовжити?}
    Continue -->|Так| SelectContent
    Continue -->|Ні| End([Завершення сесії])
\`\`\`

## Діаграма 2.2.3: Структура бази даних (ER-діаграма)

\`\`\`mermaid
erDiagram
    USERS ||--o{ STUDENT_PROFILES : has
    USERS ||--o{ TEACHER_PROFILES : has
    USERS {
        uuid id PK
        string email
        string password_hash
        string role
        timestamp created_at
    }
    
    STUDENT_PROFILES ||--o{ LEARNING_PROGRESS : tracks
    STUDENT_PROFILES ||--o{ CHAT_SESSIONS : participates
    STUDENT_PROFILES {
        uuid id PK
        uuid user_id FK
        string full_name
        string class_name
        int current_level
        json preferences
    }
    
    TEACHER_PROFILES ||--o{ CLASSES : manages
    TEACHER_PROFILES {
        uuid id PK
        uuid user_id FK
        string full_name
        string access_code
    }
    
    CLASSES ||--o{ STUDENT_PROFILES : contains
    CLASSES {
        uuid id PK
        uuid teacher_id FK
        string class_name
        string subject
    }
    
    LEARNING_PROGRESS ||--o{ TASK_RESULTS : includes
    LEARNING_PROGRESS {
        uuid id PK
        uuid student_id FK
        uuid topic_id FK
        float progress_percent
        int current_streak
        timestamp last_activity
    }
    
    TOPICS ||--o{ LEARNING_PROGRESS : measured_by
    TOPICS ||--o{ TASKS : contains
    TOPICS {
        uuid id PK
        string title
        string description
        string difficulty_level
        json content
    }
    
    TASKS ||--o{ TASK_RESULTS : generates
    TASKS {
        uuid id PK
        uuid topic_id FK
        string task_type
        json task_data
        string difficulty
    }
    
    TASK_RESULTS {
        uuid id PK
        uuid progress_id FK
        uuid task_id FK
        json student_answer
        float score
        json ai_feedback
        timestamp completed_at
    }
    
    CHAT_SESSIONS ||--o{ CHAT_MESSAGES : contains
    CHAT_SESSIONS {
        uuid id PK
        uuid student_id FK
        timestamp started_at
        timestamp ended_at
        string status
    }
    
    CHAT_MESSAGES {
        uuid id PK
        uuid session_id FK
        string role
        text content
        json metadata
        timestamp created_at
    }
    
    BADGES ||--o{ STUDENT_BADGES : awarded_to
    BADGES {
        uuid id PK
        string name
        string description
        string icon
        json criteria
    }
    
    STUDENT_BADGES {
        uuid id PK
        uuid student_id FK
        uuid badge_id FK
        timestamp earned_at
    }
\`\`\`

## Діаграма 2.2.4: Потік даних в системі (Data Flow)

\`\`\`mermaid
flowchart LR
    subgraph Client
        A[React Components]
        B[Local State]
    end
    
    subgraph Server
        C[API Routes]
        D[Server Actions]
        E[AI Processing]
    end
    
    subgraph External
        F[AI Models API]
        G[LLM Provider]
    end
    
    subgraph Storage
        H[(Database)]
        I[(Cache)]
    end
    
    A -->|HTTP Request| C
    A -->|Form Submit| D
    B <-->|State Sync| A
    
    C -->|Query| H
    D -->|Read/Write| H
    C -->|Check| I
    
    D -->|AI Request| E
    E -->|API Call| F
    F -->|LLM Query| G
    G -->|Response| F
    F -->|AI Answer| E
    E -->|Processed Data| D
    
    H -->|Cache Update| I
    D -->|Response| A
    C -->|JSON Data| A
\`\`\`

## Діаграма 2.2.5: Алгоритм генерації персоналізованого контенту

\`\`\`mermaid
flowchart TD
    Start([Запит на контент]) --> GetStudent[Отримання даних учня]
    GetStudent --> Factors[Збір факторів персоналізації]
    
    Factors --> F1[Поточний рівень]
    Factors --> F2[Історія помилок]
    Factors --> F3[Темп навчання]
    Factors --> F4[Стиль навчання]
    Factors --> F5[Час активності]
    
    F1 --> Aggregate[Агрегація даних]
    F2 --> Aggregate
    F3 --> Aggregate
    F4 --> Aggregate
    F5 --> Aggregate
    
    Aggregate --> BuildPrompt[Формування промпту для AI]
    BuildPrompt --> Context[Додавання контексту теми]
    Context --> Rules[Додавання педагогічних правил]
    
    Rules --> SendAI[Відправка до AI-моделі]
    SendAI --> Generate{Генерація контенту}
    
    Generate --> Task[Завдання]
    Generate --> Explanation[Пояснення]
    Generate --> Hints[Підказки]
    Generate --> Examples[Приклади]
    
    Task --> Validate{Валідація}
    Explanation --> Validate
    Hints --> Validate
    Examples --> Validate
    
    Validate -->|Не відповідає| Regenerate[Регенерація]
    Regenerate --> SendAI
    
    Validate -->|Відповідає| Format[Форматування]
    Format --> Cache[Кешування результату]
    Cache --> Return([Повернення контенту])
